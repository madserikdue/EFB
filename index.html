<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MeBriefing EFB</title>

<!-- Manifest -->
<link rel="manifest" href="manifest.json">
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABJklEQVRYR+2WsQ3CMAxFe0SQh6A0sQd3E4hn0tTnQeX0pGjH4Dn3tWIZYAD9IYy0ngGlm4Ah4AOqA0Wrhu4BAoAA3wHQW0mQAxQ0dE7i9b8c6SUp3Mi9Of9kbPY7kcOAwHh5BhNGE4kFmHg3FmyDl+9yE1kXUgjY9AG7sG3vQpZXwX1W4Qb4cLrAMnB3wRY8LfXxOCVtwnXbObnIN4NKh+kIK/l92l8GuAfE4lEDr9/UQQu0DOIh0Eo5WhLfwfId5t/8sXwA+HkX8FfNc4AAAAASUVORK5CYII=">

<style>
:root{
  --bg:#0a0f1a;         
  --tab:#13294a;        
  --tab-active:#1c3a70; 
  --accent:#1e90ff;     
  --text:#e6eef8;
  --card:#0f1a2a;
}
body {margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text);}
header {display:flex;justify-content:space-between;align-items:center;background:var(--tab);padding:10px;}
header .flight-info span {margin-right:15px;font-weight:600;}
nav {display:flex;background:var(--tab);}
nav button {flex:1;padding:10px;border:none;background:var(--tab);color:var(--text);cursor:pointer;font-weight:600;transition:background 0.2s;}
nav button.active {background:var(--tab-active);}
.tab {display:none;height:calc(100vh - 90px);padding:10px;}
.tab.active {display:block;}
#map {width:100%;height:100%;}
textarea,input {width:100%;margin:5px 0;padding:8px;border-radius:6px;border:none;background:#0f1a2a;color:var(--text);}
button {padding:8px 12px;margin:5px 0;background:var(--accent);border:none;border-radius:6px;color:white;cursor:pointer;}
.log-tabs {display:flex;gap:5px;flex-wrap:wrap;margin-bottom:10px;}
.log-tab {padding:5px 10px;background:var(--tab);border-radius:5px;cursor:pointer;}
.log-tab.active {background:var(--tab-active);}
iframe {border:none;}
</style>
</head>
<body>

<header>
  <div class="flight-info">
    <span id="flightNumber">Flug: ---</span>
    <span id="dep">DEP: ---</span>
    <span id="arr">ARR: ---</span>
    <span id="aircraft">ACFT: ---</span>
    <span id="reg">REG: ---</span>
  </div>
  <div id="clock">--:--:--</div>
</header>

<nav>
  <button onclick="openTab(event,'dashboard')" class="active">Dashboard</button>
  <button onclick="openTab(event,'docs')">Docs</button>
  <button onclick="openTab(event,'map')">Map</button>
  <button onclick="openTab(event,'charts')">Charts</button>
  <button onclick="openTab(event,'logbook')">Logbook</button>
  <button onclick="openTab(event,'settings')">Settings</button>
</nav>

<div id="dashboard" class="tab active">
  <h2>Flugübersicht</h2>
  <div id="dashboard-content">Bitte Flugplan laden.</div>
</div>

<div id="docs" class="tab">
  <h2>PDF Viewer</h2>
  <input type="file" id="pdf-file" accept="application/pdf">
  <iframe id="pdf-frame" src="" style="width:100%;height:90%;"></iframe>
</div>

<div id="map" class="tab">
  <div id="map"></div>
</div>

<div id="charts" class="tab">
  <h2>Charts</h2>
  <button onclick="window.open('https://planner.flightsimulator.com','_blank')">Charts öffnen</button>
</div>

<div id="logbook" class="tab">
  <div class="log-tabs" id="log-tabs"></div>
  <div id="log-content"><p>Wähle einen Flug oder lade einen SimBrief-Plan.</p></div>
</div>

<div id="settings" class="tab">
  <h2>Settings</h2>
  <label>SimBrief Username:</label>
  <input type="text" id="simbriefId"><br>
  <button onclick="loadFlight()">Flugplan laden</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// === Tabs ===
function openTab(e,id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  e.currentTarget.classList.add('active');
}

// === Clock ===
function updateClock(){ const now=new Date(); document.getElementById("clock").textContent=now.toLocaleTimeString(); }
setInterval(updateClock,1000); updateClock();

// === Map ===
var map=L.map('map').setView([50,10],4);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{
  attribution:'&copy; OpenStreetMap &copy; Carto',subdomains:'abcd',maxZoom:19
}).addTo(map);
var routeLayer=L.polyline([],{color:'#1e90ff',weight:4}).addTo(map);
var markerLayer=L.layerGroup().addTo(map);

// === PDF Viewer ===
document.getElementById('pdf-file').addEventListener('change',function(e){
  const file=e.target.files[0];
  if(file) document.getElementById('pdf-frame').src=URL.createObjectURL(file);
});

// === Logbook ===
var logs=JSON.parse(localStorage.getItem("mebrief_logs")||"{}");
var currentFlight=null;
function renderLogTabs(){
  const tabs=document.getElementById("log-tabs"); tabs.innerHTML="";
  for(const flight in logs){
    const b=document.createElement("div");
    b.className="log-tab"+(flight===currentFlight?" active":""); b.textContent=flight;
    b.onclick=()=>{ currentFlight=flight; renderLogContent(); renderLogTabs();}
    tabs.appendChild(b);
  }
}
function renderLogContent(){
  const c=document.getElementById("log-content");
  if(!currentFlight){ c.innerHTML="<p>Wähle einen Flug aus.</p>"; return;}
  let l=logs[currentFlight]||"";
  c.innerHTML=`<textarea id="logarea" rows="10">${l}</textarea><br>
  <button onclick="saveCurrentLog()">Speichern</button>`;
}
function saveCurrentLog(){
  const val=document.getElementById("logarea").value;
  logs[currentFlight]=val;
  localStorage.setItem("mebrief_logs",JSON.stringify(logs));
  alert("Gespeichert!");
}
renderLogTabs();

// === SimBrief Loader ===
async function loadFlight(){
  const id=document.getElementById("simbriefId").value.trim();
  if(!id){alert("Bitte SimBrief ID eingeben."); return;}
  localStorage.setItem("simbriefId",id);
  // Beispiel: hier kann man XML API parsen, aktuell Dummy-Flug
  const flightNum="AB123"; const dep="EGLL"; const arr="EHAM"; const acft="A320"; const reg="D-ABCD";
  document.getElementById("flightNumber").textContent="Flug: "+flightNum;
  document.getElementById("dep").textContent="DEP: "+dep;
  document.getElementById("arr").textContent="ARR: "+arr;
  document.getElementById("aircraft").textContent="ACFT: "+acft;
  document.getElementById("reg").textContent="REG: "+reg;
  document.getElementById("dashboard-content").innerHTML=`<ul><li>${flightNum}</li><li>${dep}</li><li>${arr}</li><li>${acft}</li><li>${reg}</li></ul>`;
  // Route Beispiel
  const route=[[51.4775,-0.4614],[52.3105,4.7683]]; routeLayer.setLatLngs(route);
  markerLayer.clearLayers();
  route.forEach((p,i)=>{L.marker(p).addTo(markerLayer).bindPopup("WP "+(i+1));});
  // Logbook Tab erstellen
  currentFlight=flightNum; if(!logs[flightNum]) logs[flightNum]=""; renderLogTabs(); renderLogContent();
}
</script>
</body>
</html>
